#!/bin/sh
bold="$(tput bold)"
normal="$(tput sgr0)"
if git remote -v | grep -q paulssonlab/paulssonlab; then
    # cloned from paulssonlab account, fork
    hub fork --remote-name origin
    status=$?
    if [ $status != 0 ] ; then
        echo "❌  ${bold}Could not fork repo, aborting.${normal}"
        exit 1
    fi
else
    # cloned from personal account, add upstream remote
    git remote add upstream git@github.com:paulssonlab/paulssonlab.git
fi
# make paulssonlab conda env
bin/direnv-allowall
# check that direnv loaded/conda env was created
envname_file=.envname
if ! [ -f "$envname_file" ] && [ $CONDA_DEFAULT_ENV = "$(cat "$envname_file")" ]; then
    echo "❌  ${bold}Conda environment was not created/loaded successfully, aborting.${normal}"
    exit 1
fi
# install pre-commit hooks
pre-commit install --install-hooks &&
    pre-commit install --install-hooks -t commit-msg
status=$?
if [ $status != 0 ] ; then
    echo "❌  pre-commit install${bold}failed, aborting.${normal}"
    exit $status
fi
# run git status (so git builds its cache before we install the nbcleanse filter)
git status > /dev/null
# install nbcleanse
git clone git@github.com:shenker/nbcleanse.git $root/.nbcleanse
.nbcleanse/nbcleanse.py install
