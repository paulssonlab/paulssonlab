#!/bin/sh
bold="$(tput bold)"
normal="$(tput sgr0)"
envname="$1"
if [ -z "$envname" ]; then
    read -p "ğŸ’¬  ${bold}Name of conda environment to create: ${normal}" envname
fi
if [ -z "$envname" ]; then
    echo "âŒ  ${bold}Environment name required, aborting.${normal}"
    exit 1
fi
read -n 1 -p "ğŸ“Š  ${bold}Do you want to install JupyterLab/HoloViews/Bokeh/Matplotlib to environment ${envname} now? ${normal}[y/N] " answer
echo
case ${answer:0:1} in
    y|Y )
        # SEE: https://stackoverflow.com/questions/1167746/how-to-assign-a-heredoc-value-to-a-variable-in-bash
        packages=$(cat <<EOF
name: ${envname}
channels:
  - pyviz
  - conda-forge
  - defaults
dependencies:
  - black
  - bokeh
  - cachetools
  - click
  - holoviews
  - hvplot
  - ipywidgets
  - jupyterlab
  - matplotlib
  - nbformat
  - numpy
  - nodejs
  - pandas
  - pip
  - pip:
      - docformatter
  - pre-commit
EOF
        )
    ;;
    * )
        echo "${bold}If you need these in the future, you can always run${normal}"
        echo
        echo "    conda install -y -c pyviz jupyterlab holoviews hvplot bokeh matplotlib nodejs numpy pandas"
        echo "    export-env"
        echo "    prepare-env"
        echo
        packages=$(cat <<EOF
name: ${envname}
channels:
  - conda-forge
  - defaults
dependencies:
  - black
  - cachetools
  - click
  - nbformat
  - pip
  - pip:
      - docformatter
  - pre-commit
EOF
        )
    ;;
esac
echo "âœï¸   ${bold}Writing packages to environment.yml${normal}"
echo "$packages" > environment.yml
echo "âœï¸   ${bold}Writing environment name '${envname}' to .envname${normal}"
echo "$envname" > .envname
make-envrc
