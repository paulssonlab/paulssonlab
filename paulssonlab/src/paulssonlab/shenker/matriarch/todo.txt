###

ImageMetadataLV!
? 126992:ImageCalibrationLV|0!
? 131088:ImageMetadataSeqLV|0!
? 204816:ImageCalibrationLV|0!
image_metadata_sequence 208912:ImageMetadataSeqLV|0!
? 286736:ImageAttributesLV!
image_calibration 3752952739:ImageCalibrationLV|0!
image_attributes 3752952776:ImageAttributesLV!
z_data 3752952810:CustomData|Z!
y_data 3752952839:CustomData|Y!
x_data 3752952868:CustomData|X!
CUSTOM 3752952897:CustomData|TimeSourceCache!
CUSTOM 3752952940:CustomData|RoiRleGlobal_v1!
pfs_status 3752952983:CustomData|PFS_STATUS!
pfs_offset 3752953021:CustomData|PFS_OFFSET!
camera_exposure_time 3752953059:CustomData|Camera_ExposureTime1!
camera_temp 3752953107:CustomData|CameraTemp1!
acquisition_times 3752953146:CustomData|AcqTimesCache!
acquisition_times_2 3752953187:CustomData|AcqTimes2Cache!
acquisition_frames 3752953229:CustomData|AcqFramesCache!
CUSTOM 3752953271:CustomDataVar|StreamDataV1_0!
CUSTOM 3752953316:CustomDataVar|NDControlV1_0!
lut_data 3752953360:CustomDataVar|LUTDataV1_0!
grabber_settings 3752953402:CustomDataVar|GrabberCameraSettingsV1_0!
custom_data 3752953458:CustomDataVar|CustomDataV2_0!
app_info 3752953503:CustomDataVar|AppInfo_V1_0!
CUSTOM 3752953546:CustomDataVar|AcqTimeV1_0!

done 3752926025:ImageDataSeq|10686!

###

blur trench profile, set minimum trench spacing
fix rotation: do non-binary hough, try edge-filtering first

set of scatter plots synchronized to qgrid (bidirectional RangeXY), tool tips
SEE: https://github.com/ioam/holoviews/issues/1600

STORE CHANNELS IN SEPARATE ARRAYS? new path: raw/pos0/ch1
ingest_tiff
ingest_tiff --watch (need some way of updating latest field, poll metadata?)
trench_pack
trench_pack QUALITY THRESHOLDS for trench detection, if it fails just keep whole frame unmodified (or quantized, if --quantize-trench)
trench_pack --quantize-trench/--quantize-fov (which keeps a quantized whole-FOV copy in pos#/ch0/fov)
trench_pack --crop-fov (for each trench set keeps only bounding box of all trench thumb corners, which can be combined with --quantize-fov)
inventory_data --formats nd2,tiff,zarr
PARALLELIZE ingest_nd2, ingest_tiff, quantize

perfect trench detection on old data, then new data

use first N=20, majority vote to constrain all others
fix too-narrow periods
fix period-finding: trench intensity normalization
fix rotation

NONE_POS:
3: intensity hough, no peaks in dxs.max()
44: same
50: same, end of row (half of frame blank)
76: same
239: single peak, need to normalize trenches before period-finding (for each disjoint segment in segmentation mask, normalize to max in that segment)

mother cell endpoint tracking
mother cell segmentation mask
allow image viewer to overlay seg masks, trench thumb boundaries easily
fluorescent readout using cell masks

switch to pipenv on orchestra / FIX JUPYTER THEME (git repo/rectify with Bancroft)

REPLY TO HOLOVIEWS DEVS

fix pickling of diag_pos:
    make sure pickle isn't doing something stupid (compare pickled sizes with asized)
    compress/quantize/change dtype/crop intermediates (esp. masks)
    load raw images from disk
set up viewer for quick refresh of new data (just send new data to Stream)
fix none_pos
use trench_spacing to identify good/bad trench finding, use median (robust metric) from first 10 positions to constrain trench finding for rest of positions
refactor trench detection, only detect rotation once
per-trench and per-frame sharpness
per-trench and per-frame debris/QA detector
dataframe join with per-frame, per-trench metadata

rotation-invariant detrending
test detect_trenches on each position using max-stack, on a few positions using each timepoint (use trench spacing/rotation as benchmark)
look for brightest N pixels in trench cross-sections, show in table/next-prev browser so I can click and have viewer load/crop to trench
synchronize RangeXY of all images

####################

plot browser: only update visible outputs (accordion state)

replace ingested/processed flag with finished flag

minimum spacing from smallest consecutive peak spacing
weight periodogram by peak height (?? this may be bad)

non-binary hough transform (??)
2nd, 3rd cell endpoint tracking, masks
UI
tiff metadata/sketch of folder watcher (“stream”) command

compute loading statistics (over time)

allow multiple accordion panes to be open simultaneously (see ipywidgets bug)
figure out why regrid(aggregator='mode') segfaults
revisit holoviews image axis inversion/overlay bug
fix bokeh toolbar/wheel zoom on by default

sublime remotesubl retry

command-line ingest/quantize commands (incl. option to only process first N)
auto LSF parallelization for ingest/quantize
auto-detect quantization level (need “natural image” vs. independent noise heuristic)

get rid of ingest_nd2_file
implement quantize_nd2 by allowing ingest_nd2 take a filter func
profile quantize

allow image viewer to overlay trenches easily
link image viewer to frame stepping widget
improve rotation detection/trench finding
mother cell endpoint tracking
mother cell volume mask
allow image viewer to overlay mean cell intensity/variance easily on seg masks
beyond mother cell tracking

spatial barcode warp/metric/clustering

unify process_arrays, process_attrs, ingest_nd2 so they can all share the same parallelization/remote execution/completion status tracking/progress bar infrastructure

fast/parallel nd2 to zarr converter, with progress bar (command line tool)

crosstalk composite
use fluorescent channel when doing lineage tracking

process_frames: register computed groups callback to compute on demand (TODO: use threading to store, return computed value immediately), provide require_computed, keep track of which (c, t) have been computed
LATER: need to handle versioning of computed callbacks

universal caching/storage layer (look up diagnostic/intermediate calculations, if not found, recompute and store them)

POLISH:
alignment between kymograph pixel centers and sharpness plot points
pixel value live display
turn on wheel zoom by default
DWG overlay

AFTER BUG FIX/WORKAROUND:
live-updating intersected point on thumbnail

NICE THINGS:
replace thumbnail viewer with full-size image viewer
stich together multiple fields in image viewer, toggle to use unified or per-field coördinate system
